digraph G {
  node [shape=box];

  subgraph cluster1 {
    label = "client";

    subgraph cluster11 {
      label = "Configuring";

      requestingName_client [label = "requestingName\nenter: configurationRequest"];
      sendingName_client [label = "sendingName\nenter: send(PlayerNameCfg)"]
      savingPlayerName_client [label = "savingPlayerName\nenter: save received name"]
      receivingPlayerList [label = "receivingPlayerList\nenter: send(PlayerNameCnf)"];
      savingPlayerNames [label = "savingPlayerNames\nenter: savePlayerNames\nenter:send(PlayerListCnf)"];

      requestingName_client -> sendingName_client [label = "configurationResponse"];
      sendingName_client -> savingPlayerName_client [label = "received: PlayerNameCfg"];
      savingPlayerName_client -> receivingPlayerList;
      receivingPlayerList -> savingPlayerNames [label = "received: PlayerNamesCfg"];
    }

    waitingForConnection -> requestingName_client [label = "connectedToDraft"];
    savingPlayerNames -> clientDone;
  }

  subgraph cluster2 {
    label = "Server";

    listeningForConnections [label = "listeningForConnections\nclientConnected: create ClientStateMachine for client"];

    subgraph cluster21 {
      label = "ClientStateMachine";
  
      subgraph cluster211 {
        label = "Configuring";

        requestingName_server [label = "requestingName\nenter: configurationRequest"];
	sendingName_server [label = "sendingName\nenter: send(PlayerNameCfg)"];	
	savingPlayerName_server [label = "savingPlayerName\nenter: save received name"];
	waitingForAllPlayersToConnect;
	sendingPlayerList [label = "sendingPlayerList\nenter: send(PlayerNamesCfg)"];

	receivingClientName -> savingPlayerName_server [label = "received: PlayerNameCfg"];
	savingPlayerName_server -> requestingName_server;
	requestingName_server -> sendingName_server [label = "configurationResponse"];
	sendingName_server -> waitingForAllPlayersToConnect [label = "received: PlayerNameCnf"];
	waitingForAllPlayersToConnect -> sendingPlayerList [label = "startDraft"];
      }
    } 

    listeningForConnections -> receivingClientName [style=dotted];
    sendingPlayerList -> serverDone [label = "received: PlayerNamesCnf"];
  }

  null [shape = plaintext label=""];
  null -> chooseClientOrServer;
  chooseClientOrServer -> waitingForConnection [label = "connectToDraft"];
  chooseClientOrServer -> listeningForConnections [label = "hostDraft"];
}